"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "default", {
    enumerable: true,
    get: function() {
        return _default;
    }
});
const _qs = /*#__PURE__*/ _interop_require_default(require("qs"));
const _react = /*#__PURE__*/ _interop_require_wildcard(require("react"));
const _reacti18next = require("react-i18next");
const _reactrouterdom = require("react-router-dom");
const _usePayloadAPI = /*#__PURE__*/ _interop_require_default(require("../../../../hooks/usePayloadAPI"));
const _buildStateFromSchema = /*#__PURE__*/ _interop_require_default(require("../../../forms/Form/buildStateFromSchema"));
const _fieldtypes = require("../../../forms/field-types");
const _Auth = require("../../../utilities/Auth");
const _Config = require("../../../utilities/Config");
const _DocumentInfo = require("../../../utilities/DocumentInfo");
const _EditDepth = require("../../../utilities/EditDepth");
const _FormQueryParams = require("../../../utilities/FormQueryParams");
const _Locale = require("../../../utilities/Locale");
const _RenderCustomComponent = /*#__PURE__*/ _interop_require_default(require("../../../utilities/RenderCustomComponent"));
const _NotFound = /*#__PURE__*/ _interop_require_default(require("../../NotFound"));
const _Default = /*#__PURE__*/ _interop_require_default(require("./Default"));
const _formatFields = /*#__PURE__*/ _interop_require_default(require("./formatFields"));
function _interop_require_default(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
function _getRequireWildcardCache(nodeInterop) {
    if (typeof WeakMap !== "function") return null;
    var cacheBabelInterop = new WeakMap();
    var cacheNodeInterop = new WeakMap();
    return (_getRequireWildcardCache = function(nodeInterop) {
        return nodeInterop ? cacheNodeInterop : cacheBabelInterop;
    })(nodeInterop);
}
function _interop_require_wildcard(obj, nodeInterop) {
    if (!nodeInterop && obj && obj.__esModule) {
        return obj;
    }
    if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
        return {
            default: obj
        };
    }
    var cache = _getRequireWildcardCache(nodeInterop);
    if (cache && cache.has(obj)) {
        return cache.get(obj);
    }
    var newObj = {
        __proto__: null
    };
    var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;
    for(var key in obj){
        if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) {
            var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;
            if (desc && (desc.get || desc.set)) {
                Object.defineProperty(newObj, key, desc);
            } else {
                newObj[key] = obj[key];
            }
        }
    }
    newObj.default = obj;
    if (cache) {
        cache.set(obj, newObj);
    }
    return newObj;
}
const EditView = (props)=>{
    const { collection: incomingCollection, isEditing } = props;
    const { slug: collectionSlug, admin: { components: { views: { Edit } = {} } = {} } = {} } = incomingCollection;
    const [fields] = (0, _react.useState)(()=>(0, _formatFields.default)(incomingCollection, isEditing));
    const [collection] = (0, _react.useState)(()=>({
            ...incomingCollection,
            fields
        }));
    const [redirect, setRedirect] = (0, _react.useState)();
    const [formQueryParams, setFormQueryParams] = (0, _react.useState)({
        depth: 0,
        'fallback-locale': 'null',
        locale: '',
        uploadEdits: undefined
    });
    const formattedQueryParams = _qs.default.stringify(formQueryParams);
    const { code: locale } = (0, _Locale.useLocale)();
    const config = (0, _Config.useConfig)();
    const { routes: { admin, api }, serverURL } = config;
    const { params: { id } = {} } = (0, _reactrouterdom.useRouteMatch)();
    const history = (0, _reactrouterdom.useHistory)();
    const [internalState, setInternalState] = (0, _react.useState)();
    const [updatedAt, setUpdatedAt] = (0, _react.useState)();
    const { permissions, user } = (0, _Auth.useAuth)();
    const userRef = (0, _react.useRef)(user);
    const { docPermissions, getDocPermissions, getDocPreferences, getVersions } = (0, _DocumentInfo.useDocumentInfo)();
    const { t } = (0, _reacti18next.useTranslation)('general');
    const [{ data, isError, isLoading: isLoadingData }, { refetchData }] = (0, _usePayloadAPI.default)(isEditing ? `${serverURL}${api}/${collectionSlug}/${id}` : '', {
        initialData: null,
        initialParams: {
            depth: 0,
            draft: 'true',
            'fallback-locale': 'null'
        }
    });
    const buildState = (0, _react.useCallback)(async (doc, overrides)=>{
        const preferences = await getDocPreferences();
        const state = await (0, _buildStateFromSchema.default)({
            id,
            config,
            data: doc || {},
            fieldSchema: overrides?.fieldSchema,
            locale,
            operation: 'update',
            preferences,
            t,
            user: userRef.current,
            ...overrides
        });
        setInternalState(state);
    }, [
        getDocPreferences,
        id,
        locale,
        t,
        config
    ]);
    const onSave = (0, _react.useCallback)(async (json)=>{
        getVersions();
        getDocPermissions();
        setUpdatedAt(json?.doc?.updatedAt);
        if (!isEditing) {
            setRedirect(`${admin}/collections/${collection.slug}/${json?.doc?.id}`);
        } else {
            buildState(json.doc, {
                fieldSchema: collection.fields
            });
            setFormQueryParams((params)=>({
                    ...params,
                    uploadEdits: undefined
                }));
        }
    }, [
        admin,
        getVersions,
        isEditing,
        buildState,
        getDocPermissions,
        collection
    ]);
    (0, _react.useEffect)(()=>{
        if (fields && (isEditing ? data : true)) {
            const awaitInternalState = async ()=>{
                setUpdatedAt(data?.updatedAt);
                buildState(data, {
                    fieldSchema: fields,
                    operation: isEditing ? 'update' : 'create'
                });
            };
            awaitInternalState();
        }
    }, [
        isEditing,
        data,
        buildState,
        fields
    ]);
    (0, _react.useEffect)(()=>{
        if (redirect) {
            history.push(redirect);
        }
    }, [
        history,
        redirect
    ]);
    (0, _react.useEffect)(()=>{
        setFormQueryParams((params)=>({
                ...params,
                locale
            }));
    }, [
        locale
    ]);
    (0, _react.useEffect)(()=>{
        if (history.location.state?.refetchDocumentData) {
            void refetchData();
        }
    }, [
        history.location.state?.refetchDocumentData,
        refetchData
    ]);
    if (isError) {
        return /*#__PURE__*/ _react.default.createElement(_NotFound.default, {
            marginTop: "large"
        });
    }
    const apiURL = `${serverURL}${api}/${collectionSlug}/${id}?locale=${locale}${collection.versions.drafts ? '&draft=true' : ''}`;
    const action = `${serverURL}${api}/${collectionSlug}${isEditing ? `/${id}` : ''}?${formattedQueryParams}`;
    const hasSavePermission = isEditing && docPermissions?.update?.permission || !isEditing && docPermissions?.create?.permission;
    const isLoading = !internalState || !docPermissions || isLoadingData;
    const componentProps = {
        id,
        action,
        apiURL,
        canAccessAdmin: permissions?.canAccessAdmin,
        collection,
        data,
        fieldTypes: _fieldtypes.fieldTypes,
        hasSavePermission,
        internalState,
        isEditing,
        isLoading,
        onSave,
        permissions: docPermissions,
        updatedAt: updatedAt || data?.updatedAt,
        user
    };
    return /*#__PURE__*/ _react.default.createElement(_EditDepth.EditDepthContext.Provider, {
        value: 1
    }, /*#__PURE__*/ _react.default.createElement(_FormQueryParams.FormQueryParams.Provider, {
        value: {
            formQueryParams,
            setFormQueryParams
        }
    }, /*#__PURE__*/ _react.default.createElement(_RenderCustomComponent.default, {
        CustomComponent: typeof Edit === 'function' ? Edit : undefined,
        DefaultComponent: _Default.default,
        componentProps: componentProps
    })));
};
const _default = EditView;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3NyYy9hZG1pbi9jb21wb25lbnRzL3ZpZXdzL2NvbGxlY3Rpb25zL0VkaXQvaW5kZXgudHN4Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBxdWVyeVN0cmluZyBmcm9tICdxcydcbmltcG9ydCBSZWFjdCwgeyB1c2VDYWxsYmFjaywgdXNlRWZmZWN0LCB1c2VSZWYsIHVzZVN0YXRlIH0gZnJvbSAncmVhY3QnXG5pbXBvcnQgeyB1c2VUcmFuc2xhdGlvbiB9IGZyb20gJ3JlYWN0LWkxOG5leHQnXG5pbXBvcnQgeyB1c2VIaXN0b3J5LCB1c2VSb3V0ZU1hdGNoIH0gZnJvbSAncmVhY3Qtcm91dGVyLWRvbSdcblxuaW1wb3J0IHR5cGUgeyBDb2xsZWN0aW9uUGVybWlzc2lvbiB9IGZyb20gJy4uLy4uLy4uLy4uLy4uL2F1dGgnXG5pbXBvcnQgdHlwZSB7IEZpZWxkcyB9IGZyb20gJy4uLy4uLy4uL2Zvcm1zL0Zvcm0vdHlwZXMnXG5pbXBvcnQgdHlwZSB7IFF1ZXJ5UGFyYW1UeXBlcyB9IGZyb20gJy4uLy4uLy4uL3V0aWxpdGllcy9Gb3JtUXVlcnlQYXJhbXMnXG5pbXBvcnQgdHlwZSB7IERlZmF1bHRFZGl0Vmlld1Byb3BzIH0gZnJvbSAnLi9EZWZhdWx0J1xuaW1wb3J0IHR5cGUgeyBJbmRleFByb3BzIH0gZnJvbSAnLi90eXBlcydcblxuaW1wb3J0IHVzZVBheWxvYWRBUEkgZnJvbSAnLi4vLi4vLi4vLi4vaG9va3MvdXNlUGF5bG9hZEFQSSdcbmltcG9ydCBidWlsZFN0YXRlRnJvbVNjaGVtYSBmcm9tICcuLi8uLi8uLi9mb3Jtcy9Gb3JtL2J1aWxkU3RhdGVGcm9tU2NoZW1hJ1xuaW1wb3J0IHsgZmllbGRUeXBlcyB9IGZyb20gJy4uLy4uLy4uL2Zvcm1zL2ZpZWxkLXR5cGVzJ1xuaW1wb3J0IHsgdXNlQXV0aCB9IGZyb20gJy4uLy4uLy4uL3V0aWxpdGllcy9BdXRoJ1xuaW1wb3J0IHsgdXNlQ29uZmlnIH0gZnJvbSAnLi4vLi4vLi4vdXRpbGl0aWVzL0NvbmZpZydcbmltcG9ydCB7IHVzZURvY3VtZW50SW5mbyB9IGZyb20gJy4uLy4uLy4uL3V0aWxpdGllcy9Eb2N1bWVudEluZm8nXG5pbXBvcnQgeyBFZGl0RGVwdGhDb250ZXh0IH0gZnJvbSAnLi4vLi4vLi4vdXRpbGl0aWVzL0VkaXREZXB0aCdcbmltcG9ydCB7IEZvcm1RdWVyeVBhcmFtcyB9IGZyb20gJy4uLy4uLy4uL3V0aWxpdGllcy9Gb3JtUXVlcnlQYXJhbXMnXG5pbXBvcnQgeyB1c2VMb2NhbGUgfSBmcm9tICcuLi8uLi8uLi91dGlsaXRpZXMvTG9jYWxlJ1xuaW1wb3J0IFJlbmRlckN1c3RvbUNvbXBvbmVudCBmcm9tICcuLi8uLi8uLi91dGlsaXRpZXMvUmVuZGVyQ3VzdG9tQ29tcG9uZW50J1xuaW1wb3J0IE5vdEZvdW5kIGZyb20gJy4uLy4uL05vdEZvdW5kJ1xuaW1wb3J0IERlZmF1bHRFZGl0IGZyb20gJy4vRGVmYXVsdCdcbmltcG9ydCBmb3JtYXRGaWVsZHMgZnJvbSAnLi9mb3JtYXRGaWVsZHMnXG5cbmNvbnN0IEVkaXRWaWV3OiBSZWFjdC5GQzxJbmRleFByb3BzPiA9IChwcm9wcykgPT4ge1xuICBjb25zdCB7IGNvbGxlY3Rpb246IGluY29taW5nQ29sbGVjdGlvbiwgaXNFZGl0aW5nIH0gPSBwcm9wc1xuXG4gIGNvbnN0IHsgc2x1ZzogY29sbGVjdGlvblNsdWcsIGFkbWluOiB7IGNvbXBvbmVudHM6IHsgdmlld3M6IHsgRWRpdCB9ID0ge30gfSA9IHt9IH0gPSB7fSB9ID1cbiAgICBpbmNvbWluZ0NvbGxlY3Rpb25cblxuICBjb25zdCBbZmllbGRzXSA9IHVzZVN0YXRlKCgpID0+IGZvcm1hdEZpZWxkcyhpbmNvbWluZ0NvbGxlY3Rpb24sIGlzRWRpdGluZykpXG4gIGNvbnN0IFtjb2xsZWN0aW9uXSA9IHVzZVN0YXRlKCgpID0+ICh7IC4uLmluY29taW5nQ29sbGVjdGlvbiwgZmllbGRzIH0pKVxuICBjb25zdCBbcmVkaXJlY3QsIHNldFJlZGlyZWN0XSA9IHVzZVN0YXRlPHN0cmluZz4oKVxuICBjb25zdCBbZm9ybVF1ZXJ5UGFyYW1zLCBzZXRGb3JtUXVlcnlQYXJhbXNdID0gdXNlU3RhdGU8UXVlcnlQYXJhbVR5cGVzPih7XG4gICAgZGVwdGg6IDAsXG4gICAgJ2ZhbGxiYWNrLWxvY2FsZSc6ICdudWxsJyxcbiAgICBsb2NhbGU6ICcnLFxuICAgIHVwbG9hZEVkaXRzOiB1bmRlZmluZWQsXG4gIH0pXG5cbiAgY29uc3QgZm9ybWF0dGVkUXVlcnlQYXJhbXMgPSBxdWVyeVN0cmluZy5zdHJpbmdpZnkoZm9ybVF1ZXJ5UGFyYW1zKVxuXG4gIGNvbnN0IHsgY29kZTogbG9jYWxlIH0gPSB1c2VMb2NhbGUoKVxuXG4gIGNvbnN0IGNvbmZpZyA9IHVzZUNvbmZpZygpXG4gIGNvbnN0IHtcbiAgICByb3V0ZXM6IHsgYWRtaW4sIGFwaSB9LFxuICAgIHNlcnZlclVSTCxcbiAgfSA9IGNvbmZpZ1xuXG4gIGNvbnN0IHsgcGFyYW1zOiB7IGlkIH0gPSB7fSB9ID0gdXNlUm91dGVNYXRjaDxSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+PigpXG4gIGNvbnN0IGhpc3RvcnkgPSB1c2VIaXN0b3J5PHsgcmVmZXRjaERvY3VtZW50RGF0YT86IGJvb2xlYW4gfT4oKVxuXG4gIGNvbnN0IFtpbnRlcm5hbFN0YXRlLCBzZXRJbnRlcm5hbFN0YXRlXSA9IHVzZVN0YXRlPEZpZWxkcz4oKVxuICBjb25zdCBbdXBkYXRlZEF0LCBzZXRVcGRhdGVkQXRdID0gdXNlU3RhdGU8c3RyaW5nPigpXG4gIGNvbnN0IHsgcGVybWlzc2lvbnMsIHVzZXIgfSA9IHVzZUF1dGgoKVxuICBjb25zdCB1c2VyUmVmID0gdXNlUmVmKHVzZXIpXG4gIGNvbnN0IHsgZG9jUGVybWlzc2lvbnMsIGdldERvY1Blcm1pc3Npb25zLCBnZXREb2NQcmVmZXJlbmNlcywgZ2V0VmVyc2lvbnMgfSA9IHVzZURvY3VtZW50SW5mbygpXG4gIGNvbnN0IHsgdCB9ID0gdXNlVHJhbnNsYXRpb24oJ2dlbmVyYWwnKVxuXG4gIGNvbnN0IFt7IGRhdGEsIGlzRXJyb3IsIGlzTG9hZGluZzogaXNMb2FkaW5nRGF0YSB9LCB7IHJlZmV0Y2hEYXRhIH1dID0gdXNlUGF5bG9hZEFQSShcbiAgICBpc0VkaXRpbmcgPyBgJHtzZXJ2ZXJVUkx9JHthcGl9LyR7Y29sbGVjdGlvblNsdWd9LyR7aWR9YCA6ICcnLFxuICAgIHsgaW5pdGlhbERhdGE6IG51bGwsIGluaXRpYWxQYXJhbXM6IHsgZGVwdGg6IDAsIGRyYWZ0OiAndHJ1ZScsICdmYWxsYmFjay1sb2NhbGUnOiAnbnVsbCcgfSB9LFxuICApXG5cbiAgY29uc3QgYnVpbGRTdGF0ZSA9IHVzZUNhbGxiYWNrKFxuICAgIGFzeW5jIChkb2MsIG92ZXJyaWRlcz86IFBhcnRpYWw8UGFyYW1ldGVyczx0eXBlb2YgYnVpbGRTdGF0ZUZyb21TY2hlbWE+WzBdPikgPT4ge1xuICAgICAgY29uc3QgcHJlZmVyZW5jZXMgPSBhd2FpdCBnZXREb2NQcmVmZXJlbmNlcygpXG5cbiAgICAgIGNvbnN0IHN0YXRlID0gYXdhaXQgYnVpbGRTdGF0ZUZyb21TY2hlbWEoe1xuICAgICAgICBpZCxcbiAgICAgICAgY29uZmlnLFxuICAgICAgICBkYXRhOiBkb2MgfHwge30sXG4gICAgICAgIGZpZWxkU2NoZW1hOiBvdmVycmlkZXM/LmZpZWxkU2NoZW1hLFxuICAgICAgICBsb2NhbGUsXG4gICAgICAgIG9wZXJhdGlvbjogJ3VwZGF0ZScsXG4gICAgICAgIHByZWZlcmVuY2VzLFxuICAgICAgICB0LFxuICAgICAgICB1c2VyOiB1c2VyUmVmLmN1cnJlbnQsXG4gICAgICAgIC4uLm92ZXJyaWRlcyxcbiAgICAgIH0pXG5cbiAgICAgIHNldEludGVybmFsU3RhdGUoc3RhdGUpXG4gICAgfSxcbiAgICBbZ2V0RG9jUHJlZmVyZW5jZXMsIGlkLCBsb2NhbGUsIHQsIGNvbmZpZ10sXG4gIClcblxuICBjb25zdCBvblNhdmUgPSB1c2VDYWxsYmFjayhcbiAgICBhc3luYyAoanNvbjogeyBkb2MgfSkgPT4ge1xuICAgICAgZ2V0VmVyc2lvbnMoKVxuICAgICAgZ2V0RG9jUGVybWlzc2lvbnMoKVxuICAgICAgc2V0VXBkYXRlZEF0KGpzb24/LmRvYz8udXBkYXRlZEF0KVxuICAgICAgaWYgKCFpc0VkaXRpbmcpIHtcbiAgICAgICAgc2V0UmVkaXJlY3QoYCR7YWRtaW59L2NvbGxlY3Rpb25zLyR7Y29sbGVjdGlvbi5zbHVnfS8ke2pzb24/LmRvYz8uaWR9YClcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGJ1aWxkU3RhdGUoanNvbi5kb2MsIHtcbiAgICAgICAgICBmaWVsZFNjaGVtYTogY29sbGVjdGlvbi5maWVsZHMsXG4gICAgICAgIH0pXG4gICAgICAgIHNldEZvcm1RdWVyeVBhcmFtcygocGFyYW1zKSA9PiAoe1xuICAgICAgICAgIC4uLnBhcmFtcyxcbiAgICAgICAgICB1cGxvYWRFZGl0czogdW5kZWZpbmVkLFxuICAgICAgICB9KSlcbiAgICAgIH1cbiAgICB9LFxuICAgIFthZG1pbiwgZ2V0VmVyc2lvbnMsIGlzRWRpdGluZywgYnVpbGRTdGF0ZSwgZ2V0RG9jUGVybWlzc2lvbnMsIGNvbGxlY3Rpb25dLFxuICApXG5cbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBpZiAoZmllbGRzICYmIChpc0VkaXRpbmcgPyBkYXRhIDogdHJ1ZSkpIHtcbiAgICAgIGNvbnN0IGF3YWl0SW50ZXJuYWxTdGF0ZSA9IGFzeW5jICgpID0+IHtcbiAgICAgICAgc2V0VXBkYXRlZEF0KGRhdGE/LnVwZGF0ZWRBdClcbiAgICAgICAgYnVpbGRTdGF0ZShkYXRhLCB7XG4gICAgICAgICAgZmllbGRTY2hlbWE6IGZpZWxkcyxcbiAgICAgICAgICBvcGVyYXRpb246IGlzRWRpdGluZyA/ICd1cGRhdGUnIDogJ2NyZWF0ZScsXG4gICAgICAgIH0pXG4gICAgICB9XG5cbiAgICAgIGF3YWl0SW50ZXJuYWxTdGF0ZSgpXG4gICAgfVxuICB9LCBbaXNFZGl0aW5nLCBkYXRhLCBidWlsZFN0YXRlLCBmaWVsZHNdKVxuXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgaWYgKHJlZGlyZWN0KSB7XG4gICAgICBoaXN0b3J5LnB1c2gocmVkaXJlY3QpXG4gICAgfVxuICB9LCBbaGlzdG9yeSwgcmVkaXJlY3RdKVxuXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgc2V0Rm9ybVF1ZXJ5UGFyYW1zKChwYXJhbXMpID0+ICh7XG4gICAgICAuLi5wYXJhbXMsXG4gICAgICBsb2NhbGUsXG4gICAgfSkpXG4gIH0sIFtsb2NhbGVdKVxuXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgaWYgKGhpc3RvcnkubG9jYXRpb24uc3RhdGU/LnJlZmV0Y2hEb2N1bWVudERhdGEpIHtcbiAgICAgIHZvaWQgcmVmZXRjaERhdGEoKVxuICAgIH1cbiAgfSwgW2hpc3RvcnkubG9jYXRpb24uc3RhdGU/LnJlZmV0Y2hEb2N1bWVudERhdGEsIHJlZmV0Y2hEYXRhXSlcblxuICBpZiAoaXNFcnJvcikge1xuICAgIHJldHVybiA8Tm90Rm91bmQgbWFyZ2luVG9wPVwibGFyZ2VcIiAvPlxuICB9XG5cbiAgY29uc3QgYXBpVVJMID0gYCR7c2VydmVyVVJMfSR7YXBpfS8ke2NvbGxlY3Rpb25TbHVnfS8ke2lkfT9sb2NhbGU9JHtsb2NhbGV9JHtcbiAgICBjb2xsZWN0aW9uLnZlcnNpb25zLmRyYWZ0cyA/ICcmZHJhZnQ9dHJ1ZScgOiAnJ1xuICB9YFxuXG4gIGNvbnN0IGFjdGlvbiA9IGAke3NlcnZlclVSTH0ke2FwaX0vJHtjb2xsZWN0aW9uU2x1Z30ke1xuICAgIGlzRWRpdGluZyA/IGAvJHtpZH1gIDogJydcbiAgfT8ke2Zvcm1hdHRlZFF1ZXJ5UGFyYW1zfWBcblxuICBjb25zdCBoYXNTYXZlUGVybWlzc2lvbiA9XG4gICAgKGlzRWRpdGluZyAmJiBkb2NQZXJtaXNzaW9ucz8udXBkYXRlPy5wZXJtaXNzaW9uKSB8fFxuICAgICghaXNFZGl0aW5nICYmIChkb2NQZXJtaXNzaW9ucyBhcyBDb2xsZWN0aW9uUGVybWlzc2lvbik/LmNyZWF0ZT8ucGVybWlzc2lvbilcblxuICBjb25zdCBpc0xvYWRpbmcgPSAhaW50ZXJuYWxTdGF0ZSB8fCAhZG9jUGVybWlzc2lvbnMgfHwgaXNMb2FkaW5nRGF0YVxuXG4gIGNvbnN0IGNvbXBvbmVudFByb3BzOiBEZWZhdWx0RWRpdFZpZXdQcm9wcyA9IHtcbiAgICBpZCxcbiAgICBhY3Rpb24sXG4gICAgYXBpVVJMLFxuICAgIGNhbkFjY2Vzc0FkbWluOiBwZXJtaXNzaW9ucz8uY2FuQWNjZXNzQWRtaW4sXG4gICAgY29sbGVjdGlvbixcbiAgICBkYXRhLFxuICAgIGZpZWxkVHlwZXMsXG4gICAgaGFzU2F2ZVBlcm1pc3Npb24sXG4gICAgaW50ZXJuYWxTdGF0ZSxcbiAgICBpc0VkaXRpbmcsXG4gICAgaXNMb2FkaW5nLFxuICAgIG9uU2F2ZSxcbiAgICBwZXJtaXNzaW9uczogZG9jUGVybWlzc2lvbnMgYXMgQ29sbGVjdGlvblBlcm1pc3Npb24sXG4gICAgdXBkYXRlZEF0OiB1cGRhdGVkQXQgfHwgZGF0YT8udXBkYXRlZEF0LFxuICAgIHVzZXIsXG4gIH1cblxuICByZXR1cm4gKFxuICAgIDxFZGl0RGVwdGhDb250ZXh0LlByb3ZpZGVyIHZhbHVlPXsxfT5cbiAgICAgIDxGb3JtUXVlcnlQYXJhbXMuUHJvdmlkZXIgdmFsdWU9e3sgZm9ybVF1ZXJ5UGFyYW1zLCBzZXRGb3JtUXVlcnlQYXJhbXMgfX0+XG4gICAgICAgIDxSZW5kZXJDdXN0b21Db21wb25lbnRcbiAgICAgICAgICBDdXN0b21Db21wb25lbnQ9e3R5cGVvZiBFZGl0ID09PSAnZnVuY3Rpb24nID8gRWRpdCA6IHVuZGVmaW5lZH1cbiAgICAgICAgICBEZWZhdWx0Q29tcG9uZW50PXtEZWZhdWx0RWRpdH1cbiAgICAgICAgICBjb21wb25lbnRQcm9wcz17Y29tcG9uZW50UHJvcHN9XG4gICAgICAgIC8+XG4gICAgICA8L0Zvcm1RdWVyeVBhcmFtcy5Qcm92aWRlcj5cbiAgICA8L0VkaXREZXB0aENvbnRleHQuUHJvdmlkZXI+XG4gIClcbn1cbmV4cG9ydCBkZWZhdWx0IEVkaXRWaWV3XG4iXSwibmFtZXMiOlsiRWRpdFZpZXciLCJwcm9wcyIsImNvbGxlY3Rpb24iLCJpbmNvbWluZ0NvbGxlY3Rpb24iLCJpc0VkaXRpbmciLCJzbHVnIiwiY29sbGVjdGlvblNsdWciLCJhZG1pbiIsImNvbXBvbmVudHMiLCJ2aWV3cyIsIkVkaXQiLCJmaWVsZHMiLCJ1c2VTdGF0ZSIsImZvcm1hdEZpZWxkcyIsInJlZGlyZWN0Iiwic2V0UmVkaXJlY3QiLCJmb3JtUXVlcnlQYXJhbXMiLCJzZXRGb3JtUXVlcnlQYXJhbXMiLCJkZXB0aCIsImxvY2FsZSIsInVwbG9hZEVkaXRzIiwidW5kZWZpbmVkIiwiZm9ybWF0dGVkUXVlcnlQYXJhbXMiLCJxdWVyeVN0cmluZyIsInN0cmluZ2lmeSIsImNvZGUiLCJ1c2VMb2NhbGUiLCJjb25maWciLCJ1c2VDb25maWciLCJyb3V0ZXMiLCJhcGkiLCJzZXJ2ZXJVUkwiLCJwYXJhbXMiLCJpZCIsInVzZVJvdXRlTWF0Y2giLCJoaXN0b3J5IiwidXNlSGlzdG9yeSIsImludGVybmFsU3RhdGUiLCJzZXRJbnRlcm5hbFN0YXRlIiwidXBkYXRlZEF0Iiwic2V0VXBkYXRlZEF0IiwicGVybWlzc2lvbnMiLCJ1c2VyIiwidXNlQXV0aCIsInVzZXJSZWYiLCJ1c2VSZWYiLCJkb2NQZXJtaXNzaW9ucyIsImdldERvY1Blcm1pc3Npb25zIiwiZ2V0RG9jUHJlZmVyZW5jZXMiLCJnZXRWZXJzaW9ucyIsInVzZURvY3VtZW50SW5mbyIsInQiLCJ1c2VUcmFuc2xhdGlvbiIsImRhdGEiLCJpc0Vycm9yIiwiaXNMb2FkaW5nIiwiaXNMb2FkaW5nRGF0YSIsInJlZmV0Y2hEYXRhIiwidXNlUGF5bG9hZEFQSSIsImluaXRpYWxEYXRhIiwiaW5pdGlhbFBhcmFtcyIsImRyYWZ0IiwiYnVpbGRTdGF0ZSIsInVzZUNhbGxiYWNrIiwiZG9jIiwib3ZlcnJpZGVzIiwicHJlZmVyZW5jZXMiLCJzdGF0ZSIsImJ1aWxkU3RhdGVGcm9tU2NoZW1hIiwiZmllbGRTY2hlbWEiLCJvcGVyYXRpb24iLCJjdXJyZW50Iiwib25TYXZlIiwianNvbiIsInVzZUVmZmVjdCIsImF3YWl0SW50ZXJuYWxTdGF0ZSIsInB1c2giLCJsb2NhdGlvbiIsInJlZmV0Y2hEb2N1bWVudERhdGEiLCJOb3RGb3VuZCIsIm1hcmdpblRvcCIsImFwaVVSTCIsInZlcnNpb25zIiwiZHJhZnRzIiwiYWN0aW9uIiwiaGFzU2F2ZVBlcm1pc3Npb24iLCJ1cGRhdGUiLCJwZXJtaXNzaW9uIiwiY3JlYXRlIiwiY29tcG9uZW50UHJvcHMiLCJjYW5BY2Nlc3NBZG1pbiIsImZpZWxkVHlwZXMiLCJFZGl0RGVwdGhDb250ZXh0IiwiUHJvdmlkZXIiLCJ2YWx1ZSIsIkZvcm1RdWVyeVBhcmFtcyIsIlJlbmRlckN1c3RvbUNvbXBvbmVudCIsIkN1c3RvbUNvbXBvbmVudCIsIkRlZmF1bHRDb21wb25lbnQiLCJEZWZhdWx0RWRpdCJdLCJtYXBwaW5ncyI6Ijs7OzsrQkE2TEE7OztlQUFBOzs7MkRBN0x3QjsrREFDd0M7OEJBQ2pDO2dDQUNXO3NFQVFoQjs2RUFDTzs0QkFDTjtzQkFDSDt3QkFDRTs4QkFDTTsyQkFDQztpQ0FDRDt3QkFDTjs4RUFDUTtpRUFDYjtnRUFDRztxRUFDQzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFekIsTUFBTUEsV0FBaUMsQ0FBQ0M7SUFDdEMsTUFBTSxFQUFFQyxZQUFZQyxrQkFBa0IsRUFBRUMsU0FBUyxFQUFFLEdBQUdIO0lBRXRELE1BQU0sRUFBRUksTUFBTUMsY0FBYyxFQUFFQyxPQUFPLEVBQUVDLFlBQVksRUFBRUMsT0FBTyxFQUFFQyxJQUFJLEVBQUUsR0FBRyxDQUFDLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDLEVBQUUsR0FDdkZQO0lBRUYsTUFBTSxDQUFDUSxPQUFPLEdBQUdDLElBQUFBLGVBQVEsRUFBQyxJQUFNQyxJQUFBQSxxQkFBWSxFQUFDVixvQkFBb0JDO0lBQ2pFLE1B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